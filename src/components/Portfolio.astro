---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import Picture from '../components/common/Picture.astro';

const categories = [
  { id: 'all', label: 'Semua Proyek' },
  { id: 'residential', label: 'Residential' },
  { id: 'commercial', label: 'Commercial' },
  { id: 'custom', label: 'Custom Projects' }
];

const allProjects = await getCollection('portfolio');
const projects = allProjects.map(item => {
  // Try to use the specific image for the project, fallback to default if not available
  const image = `/images/portfolio/${item.slug}.jpg`;

  return {
    title: item.data.title,
    category: item.data.category,
    displayCategory: item.data.displayCategory,
    image,
    description: item.data.description,
    slug: item.slug
  };
});
---
<section id="portofolio" class="section-anchor bg-[#FFF8DC] py-20 md:py-28">
  <div class="mx-auto max-w-6xl px-4 md:px-8">
    <div class="flex flex-col items-center text-center">
      <span class="badge bg-wood-brown-100 text-wood-brown-800">Portofolio Unggulan</span>
      <h2 class="mt-5 font-serif text-4xl font-semibold text-wood-brown-800 md:text-5xl">Portofolio Jasa Kayu Profesional</h2>
      <p class="mt-4 max-w-3xl text-lg leading-relaxed text-[#4A4A4A]">
        Jasa kayu profesional terbaik di Jabodetabek. Tim kami mengerjakan proyek residential, commercial, hingga instalasi custom art. Setiap karya dirancang sesuai kebutuhan gaya hidup dan citra brand klien, dengan dokumentasi lengkap mulai dari desain hingga finishing.
      </p>
    </div>
    <div class="mt-12 flex flex-wrap justify-center gap-3" role="tablist" aria-label="Filter Portofolio">
      {categories.map((category) => (
        <button
          class={`filter-button rounded-full border border-wood-brown-200 px-5 py-2.5 text-sm font-semibold transition ${category.id === 'all' ? 'bg-wood-brown-700 text-white' : 'bg-white text-wood-brown-700 hover:bg-wood-brown-100'}`}
          data-filter={category.id}
          aria-pressed={category.id === 'all' ? 'true' : 'false'}
        >
          {category.label}
        </button>
      ))}
    </div>
    <div class="mt-14 grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {projects.map((project) => (
        <figure class="portfolio-card card-hover group relative overflow-hidden rounded-3xl bg-white shadow-elegant" data-category={project.category} key={project.title}>
          <img
            src={project.image}
            alt={project.title}
            class="h-64 w-full object-cover transition duration-500 group-hover:scale-105"
            width="800"
            height="600"
            loading="lazy"
            onerror="this.onerror=null;this.src='/images/portfolio/deckingulin-1.jpg';"
          />
          <figcaption class="flex flex-col gap-3 p-6">
            <span class="text-xs font-semibold uppercase tracking-wide text-wood-brown-500">{project.displayCategory}</span>
            <h3 class="font-serif text-2xl font-semibold text-wood-brown-800">{project.title}</h3>
            <p class="text-sm leading-relaxed text-[#4A4A4A]">{project.description}</p>
            <a
              href={`/portfolio/${project.slug}`}
              class="mt-2 inline-flex items-center gap-2 self-start text-sm font-semibold text-wood-brown-700 hover:text-wood-brown-900"
            >
              Lihat Detail
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" aria-hidden="true">
                <path fill="currentColor" d="M5 12a1 1 0 0 1 1-1h10.586l-3.293-3.293a1 1 0 0 1 1.414-1.414l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 0 1-1.414-1.414L16.586 13H6a1 1 0 0 1-1-1Z" />
              </svg>
            </a>
          </figcaption>
        </figure>
      ))}
    </div>
  </div>
</section>
